<div style="text-align: center; margin-top: 6rem">
  <p class="display-4">Stock Search</p>
</div>
<form (submit)="search(); $event.preventDefault();">
  <div class="container" style="margin-top: 3rem">
    <div class="row justify-content-center">
      <div class="col-lg-6 col-12">
        <div class="input-group mb-3 input-group-order">
          <input type="text" class="form-control input-no-focus" [matAutocomplete]="auto" [formControl]="formControl"
            style="border: none" placeholder="Enter Stock Ticker Symbol" aria-label="Stock Ticker"
            aria-describedby="basic-addon2" [matAutocomplete]="auto">
          <mat-autocomplete #auto="matAutocomplete">
            <ng-container *ngIf="isLoading">
              <mat-option>
                <mat-spinner diameter="20"></mat-spinner>
              </mat-option>
            </ng-container>
            <mat-option *ngFor="let s of filteredStocks | async;" [value]="s.displaySymbol">
              {{ s.displaySymbol }} | {{ s.description }}
            </mat-option>
          </mat-autocomplete>
          <div class="input-group-append row">
            <div class="col-4">
              <button class="btn btn-block" type="submit">
                <i class="bi bi-search" style="font-size: 1.5rem;"></i>
              </button>
            </div>
            <div class="col-4">
              <button class="btn btn-block" type="reset" (click) = "navigateToHome()">
                <i class="bi bi-x" style="font-size: 1.5rem;"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>
<div *ngIf="!isEmptyObject(stock) && alerts.length == 0" class="row my-5">
  <div class="col-4">
    <table class="table d-flex justify-content-end">
      <tbody>
        <tr>
          <td class="text-center border-bottom-0 py-2 d-flex align-items-center justify-content-center">
            <p class="my-0 py-0 px-2 d-inline" style="font-size: 40px; font-weight: 700">{{stock.ticker}}</p>
            <i class="bi bi-star d-inline" style="font-size: 1.2rem;"></i>
          </td>
        </tr>
        <tr>
          <td class="text-center border-bottom-0 py-2">
            <h2 class="my-0 py-0" style="font-size: 30px; color: rgb(87, 89, 91); font-weight: 400">{{stock.name}}</h2>
          </td>
        </tr>
        <tr>
          <td class="text-center border-bottom-0 py-2">
            <p class="my-0 py-0" style="font-size: medium; color: rgb(87, 89, 91); font-weight: 400">{{stock.exchange}}
            </p>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="col-4 d-flex align-items-stretch">
    <div class="d-flex align-items-center justify-content-center" style="width: 100%;">
      <img style="width: 100px; height: 100px" src="{{stock.logo}}" />
    </div>
  </div>
  <div *ngIf="!isEmptyObject(quote)" class="col-4">
    <table class="table d-flex justify-content-start">
      <tbody>
        <tr>
          <td class="text-center border-bottom-0 py-2">
            <p [class.text-green]="quote.dp > 0" [class.text-red]="quote.dp < 0" class="my-0 py-0"
              style="font-size: 40px; font-weight: 700">{{quote.c}}</p>
          </td>
        </tr>
        <tr>
          <td class="text-center border-bottom-0 py-2">
            <p [class.text-green]="quote.dp > 0" [class.text-red]="quote.dp < 0" class="my-0 py-0"
              style="font-size: 30px; font-weight: 400">{{quote.d}} ({{quote.dp}}%)</p>
          </td>
        </tr>
        <tr>
          <td class="text-center border-bottom-0 py-2">
            <p class="my-0 py-0" style="font-size: medium; color: rgb(87, 89, 91); font-weight: 400">
              {{changeTimeFormat(quote.t)}}</p>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
<ngb-alert *ngIf="alerts.length > 0" [type]="alerts[0].type" (closed)="close(alerts[0])" class="mt-5 w-50 mx-auto text-center">
  {{ alerts[0].message }}
</ngb-alert>
<div *ngIf="!isEmptyObject(quote) && alerts.length == 0">
  <div class="col-12 mx-auto" style="width: 70%;">
    <ul ngbNav #nav="ngbNav" [(activeId)]="active" class="nav-tabs row" style="border: 0">
      <li [ngbNavItem]="1" class="mx-auto col-3 d-flex justify-content-center" [class.active]="active === 1">
        <button [class.button-active]="active === 1"
          style="text-align: center; border: 0; background-color: transparent; color: gray; font-weight: 600; font-size: 15px"
          ngbNavLink>Summary</button>
        <ng-template ngbNavContent>
          <div class="d-flex row justify-content-center" style="width: 70%; margin: auto;">
            <div class="p-2 col-6">
              <div class="row">
                <div class="col-6">
                  <table class="table table-borderless">
                    <tbody>
                      <tr>
                        <td class="text-center"><span style="font-weight: bold;">High Price:</span> {{quote.h}}</td>
                      </tr>
                      <tr>
                        <td class="text-center"><span style="font-weight: bold;">Low Price:</span> {{quote.l}}</td>
                      </tr>
                      <tr>
                        <td class="text-center"><span style="font-weight: bold;">Open Price:</span> {{quote.o}}</td>
                      </tr>
                      <tr>
                        <td class="text-center"><span style="font-weight: bold;">Prev. Close:</span> {{quote.pc}}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <table class="table table-borderless">
                <tbody>
                  <tr>
                    <td class="text-center">
                      <h2 style="text-decoration: underline;">About the company</h2>
                    </td>
                  </tr>
                  <tr>
                    <td class="text-center"><span style="font-weight: bold;">IPO Start Date: </span>{{stock.ipo}}</td>
                  </tr>
                  <tr>
                    <td class="text-center"><span style="font-weight: bold;">Industry: </span> {{stock.finnhubIndustry}}
                    </td>
                  </tr>
                  <tr>
                    <td class="text-center"><span style="font-weight: bold;">Webpage: </span> <a href="{{stock.weburl}}"
                        target="_blank">{{stock.weburl}}</a></td>
                  </tr>
                  <tr>
                    <td class="text-center">
                      <p style="font-weight: bold;">Company Peers:</p>
                      <span *ngFor="let peer of this.stock.peers">
                        <a [routerLink]="['/search', peer]">{{peer}},</a>
                      </span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="p-2 col-6">
              <highcharts-chart [Highcharts]="Highcharts" [options]="chartOptions" [(update)]="updateFlag1"
                [oneToOne]="oneToOneFlag" [runOutsideAngular]="runOutsideAngular"
                style="width: 70%; height: 400px; display: block;"></highcharts-chart>
            </div>
          </div>
        </ng-template>
      </li>
      <li [ngbNavItem]="2" class="mx-auto col-3 d-flex justify-content-center" [class.active]="active === 2">
        <button [class.button-active]="active === 2"
          style="text-align: center; border: 0; background-color: transparent; color: gray; font-weight: 600; font-size: 15px"
          ngbNavLink>Top News</button>
        <ng-template ngbNavContent>
          <div *ngIf="!isEmptyObject(stock)" class="d-flex row justify-content-center"
            style="width: 70%; margin: auto;">
            <ng-template #content let-modal>
              <div class="modal-header d-flex justify-content-between align-items-center w-100">
                <div style="flex-grow: 1;">
                  <h1 class="h1 mb-0 fw-bold fs-2">{{selectedNews.source}}</h1>
                  <p class="modal-subtitle m-0">{{getDate(selectedNews.datetime)}}</p>
                </div>
                <button type="button" class="no-style" aria-label="Close" (click)="modal.dismiss('Cross click')">
                  <span class="blue-text" aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <p class="fw-bold fs-4 mb-1 custom-line-height">{{selectedNews.headline}}</p>
                <p class="mb-1">{{selectedNews.summary}}</p>
                <span class="text-muted">For more details click </span><a href="{{selectedNews.url}}" target="_blank"
                  class="text-muted">here</a>
              </div>
              <div class="modal-footer custom-border flex-column align-items-start rounded-3 p-3 bg-white mb-3 mx-3">
                <div>
                  <p class="fs-4 mb-2">Share</p>
                </div>
                <div>
                  <i class="fa-brands fa-x-twitter fa-3x" role="img" aria-label="Twitter"></i>
                  <i class="fa-brands fa-square-facebook fa-3x mx-2" role="img" aria-label="Facebook"></i>
                </div>
              </div>
            </ng-template>
            <ng-container *ngFor="let news of stock.news; index as i">
              <div class="row" *ngIf="i % 2 === 0">
                <div class="col border mx-2 my-3 rounded" style="height: 120px;">
                  <div (click)="open(content); viewCard(news)" class="row h-100 align-items-center">
                    <div class="col-3 h-75 rounded">
                      <img class="img-fluid h-100 w-100 rounded" src="{{news.image}}" style="object-fit: cover;">
                    </div>
                    <p class="col-9">{{news.headline}}</p>
                  </div>
                </div>
                <div class="col border mx-2 my-3 rounded" *ngIf="stock.news[i + 1]" style="height: 120px;">
                  <div (click)="open(content); viewCard(stock.news[i+1])" data-toggle="modal" data-target="#myModal"
                    class="row h-100 align-items-center">
                    <div class="col-3 h-75 rounded">
                      <img class="img-fluid h-100 w-100 rounded" src="{{stock.news[i + 1].image}}"
                        style="object-fit: cover;">
                    </div>
                    <p class="col-9">{{stock.news[i + 1].headline}}</p>
                  </div>
                </div>
                <div class="col mx-2 my-3" *ngIf="!stock.news[i + 1]"></div>
              </div>
            </ng-container>
          </div>
        </ng-template>
      </li>
      <li [ngbNavItem]="3" class="mx-auto col-3 d-flex justify-content-center" [class.active]="active === 3">
        <button [class.button-active]="active === 3"
          style="text-align: center; border: 0; background-color: transparent; color: gray; font-weight: 600; font-size: 15px"
          ngbNavLink>Charts</button>
        <ng-template ngbNavContent>
          <div class="d-flex justify-content-center">
            <highcharts-chart class="mt-4 mb-4" [(update)]="updateFlag2" [Highcharts]="Highcharts"
              [options]="chartOptions1" style="width: 70%; height: 800px; display: block;">
            </highcharts-chart>
          </div>
        </ng-template>
      </li>
      <li [ngbNavItem]="4" class="mx-auto col-3 d-flex justify-content-center" [class.active]="active === 4">
        <button [class.button-active]="active === 4"
          style="text-align: center; border: 0; background-color: transparent; color: gray; font-weight: 600; font-size: 15px"
          ngbNavLink>Insights</button>
        <ng-template *ngIf = "sentiments.length != 0" ngbNavContent>
          <div class="mt-4 d-flex justify-content-center flex-column align-items-center">
            <p class="h2">Insider Sentiments</p>
            <table class="table w-25 text-center">
              <thead>
                <tr>
                  <th scope="col" class="align-middle">{{stock.name}}</th>
                  <th scope="col" class="align-middle">MSPR</th>
                  <th scope="col" class="align-middle">Change</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th class="align-middle">Total</th>
                  <td class="align-middle">{{sentiments[0]}}</td>
                  <td class="align-middle">{{sentiments[3]}}</td>
                </tr>
                <tr>
                  <th class="align-middle">Positive</th>
                  <td class="align-middle">{{sentiments[1]}}</td>
                  <td class="align-middle">{{sentiments[4]}}</td>
                </tr>
                <tr>
                  <th class="align-middle">Negative</th>
                  <td class="align-middle">{{sentiments[2]}}</td>
                  <td class="align-middle">{{sentiments[5]}}</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="row justify-content-center align-items-center" style="width: 70%; margin: 0 auto;">
            <div class="col-12 col-md-6">
              <highcharts-chart class="mt-4 mb-4" [(update)]="updateFlag3" [Highcharts]="Highcharts"
                [options]="chartOptions2" style="width: 100%; height: 400px; display: block; margin: 0 auto;">
              </highcharts-chart>
            </div>
            <div class="col-12 col-md-6">
              <highcharts-chart class="mt-4 mb-4" [(update)]="updateFlag4" [Highcharts]="Highcharts"
                [options]="chartOptions3" style="width: 100%; height: 400px; display: block; margin: 0 auto;">
              </highcharts-chart>
            </div>
          </div>
        </ng-template>
      </li>
    </ul>
  </div>
  <div [ngbNavOutlet]="nav" class="mt-2"></div>
</div>
